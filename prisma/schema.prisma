
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Employee {
  id          Int      @id @default(autoincrement())
  employeeId  String   @unique @map("employee_id")
  firstName   String? @map("first_name")
  lastName    String? @map("last_name")
  gender      Gender?
  dateOfBirth DateTime @map("date_of_birth")
  email       String   @unique
  password    String?
  phone       String?
  address     String?
  passwordUpdated Boolean @default(false) @map("password_updated")
  employmentStatus EmploymentStatus @default(Active) @map("employment_status")
  employmentDate DateTime @map("employment_date")
  terminationDate DateTime? @map("termination_date")

  roleId        Int  @map("role_id")
  designationId Int @map("designation_id")
  departmentId  Int  @map("department_id")
  managerId     String? @map("manager_id")

  role       Role @relation(fields: [roleId], references: [id])
  designation   Designation? @relation(fields: [designationId], references: [id])
  department  Department @relation(fields: [departmentId], references: [id])
  manager  Employee? @relation("Manager",  fields: [managerId], references: [employeeId])
  reports  Employee[] @relation("Manager") // employees reporting to this person

  leaves      Leave[]
  approvals LeaveApproval[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("employees")
}


model Role {
  id             Int              @id @default(autoincrement())
  name           String           @unique
  description    String?
  permissions    String           // comma separated list of permissions

  employees      Employee[]

  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")

  @@map("roles")
}

model Designation {
  id           Int         @id @default(autoincrement())
  title        String      
  departmentId Int
  department   Department  @relation(fields: [departmentId], references: [id])
  employees    Employee[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([title, departmentId])

  @@map("designations")
}

model Department {
  id        Int      @id @default(autoincrement())
  name      String
  code      String   @unique
  description String?

  employees Employee[]
  designations Designation[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("departments")
}

model Leave {
  id          Int      @id @default(autoincrement())
  startDate   DateTime  @map("start_date")
  endDate     DateTime  @map("end_date")
  reason      String
  status      LeaveStatus @default(Pending)

  employeeId  String   @map("employee_id")
  employee    Employee @relation(fields: [employeeId], references: [employeeId])

  leaveTypeId Int   @map("leave_type_id")
  leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])

  approvals   LeaveApproval[]
  attachments LeaveAttachment[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("leaves")
}

model LeaveApproval {
  id             Int              @id @default(autoincrement())

  leaveId         Int   @map("leave_id")
  leave           Leave   @relation(fields: [leaveId], references: [id])

  approverId      String    @map("approver_id")
  approver        Employee   @relation(fields: [approverId], references: [employeeId])

  level           Int   // 1 = direct manager, 2 = manager's manager
  decision        ApprovalDecision  @default(Pending)
  comment         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("leave_approvals")
}

model LeaveType {
  id          Int      @id @default(autoincrement())
  name        String  @unique
  description String?
  maxDays     Int?    @map("max_days")

  leaves        Leave[]
  requirements  LeaveRequirement[]

  @@map("leave_types")
}

model LeaveRequirement {
  id              Int      @id @default(autoincrement())
  type            RequirementType
  value           String

  leaveTypeId     Int          @map("leave_type_id")
  leaveType       LeaveType    @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)

  @@unique([type, leaveTypeId])

  @@map("leave_requirements")
}

model LeaveAttachment {
  id              Int      @id @default(autoincrement())
  leaveId         Int     @map("leave_id")
  leave           Leave   @relation(fields: [leaveId], references: [id])
  type            String // eg. HOSPITAL_REPORT
  url             String

  @@map("leave_attachments")
}

enum RequirementType {
  DOCUMENT
  MIN_SERVICE
  OTHER
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
  Canceled
}

enum EmploymentStatus {
  Active
  Suspended
  Terminated
}

enum Gender {
  Male
  Female
}

enum ApprovalDecision {
  Pending
  Approved
  Rejected
}